<!-- Generated by SpecStory -->

# Implementing Tanstack React Table in DealsTable (2025-04-10 17:37:14)

_**User**_

implement @Tanstack: React Table on @DealsTable() 

---

_**Assistant**_



---

Model provided invalid arguments for tool call.

---

<details>
            <summary>Searched codebase "import from '@tanstack/react-table'" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/components/ui/table.tsx` | L1-81 |
| `src/components/ui/data-table.tsx` | L1-76 |
| `src/components/admin/restaurants-table.tsx` | L1-84 |
| `src/components/admin/restaurants-table.tsx` | L929-988 |
| `src/components/ui/data-table.tsx` | L96-137 |
| `src/components/admin/restaurants-table.tsx` | L1537-1558 |
| `src/components/admin/restaurants-table.tsx` | L1488-1537 |
| `src/components/ui/table.tsx` | L81-120 |
| `src/components/admin/restaurants-table.tsx` | L1094-1124 |
| `src/components/admin/restaurants-table.tsx` | L466-532 |
| `src/components/admin/restaurants-table.tsx` | L1558-1601 |
| `src/components/admin/restaurants-table.tsx` | L401-466 |
| `src/components/admin/restaurants-table.tsx` | L124-132 |
| `src/components/admin/restaurants-table.tsx` | L1033-1094 |
| `src/components/admin/restaurants-table.tsx` | L766-822 |
| `src/components/admin/restaurants-table.tsx` | L532-586 |
| `src/components/admin/restaurants-table.tsx` | L1436-1488 |
| `src/components/admin/restaurants-table.tsx` | L84-106 |
| `src/components/admin/restaurants-table.tsx` | L1124-1156 |
| `src/components/ui/data-table.tsx` | L76-96 |
| `src/components/admin/restaurants-table.tsx` | L988-1033 |
| `src/components/admin/restaurants-table.tsx` | L586-640 |
| `src/app/admin/restaurants/restaurant-table-wrapper.tsx` | L1-11 |
| `src/components/admin/restaurants-table.tsx` | L149-196 |
| `src/components/admin/restaurants-table.tsx` | L1256-1293 |

</details>

---

Read file: src/components/admin/restaurants-table.tsx

---

Read file: src/components/admin/deals/deals-table.tsx

---

<details>
            <summary>Searched codebase "components/ui/table" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/components/ui/data-table.tsx` | L1-76 |
| `src/components/ui/table.tsx` | L1-81 |
| `src/components/ui/data-table.tsx` | L96-137 |
| `src/components/ui/table.tsx` | L81-120 |
| `src/components/ui/data-table.tsx` | L76-96 |
| `src/components/admin/restaurants-table.tsx` | L466-532 |
| `src/components/admin/restaurants-table.tsx` | L1488-1537 |
| `src/components/admin/restaurants-table.tsx` | L532-586 |
| `src/components/admin/restaurants-table.tsx` | L1-84 |
| `src/components/admin/restaurants-table.tsx` | L401-466 |
| `src/components/admin/restaurants-table.tsx` | L1094-1124 |
| `src/components/admin/restaurants-table.tsx` | L1537-1558 |
| `src/components/admin/restaurants-table.tsx` | L766-822 |
| `src/components/admin/restaurants-table.tsx` | L1436-1488 |
| `src/components/admin/restaurants-table.tsx` | L1256-1293 |
| `src/components/admin/restaurants-table.tsx` | L929-988 |
| `src/components/admin/restaurants-table.tsx` | L1558-1601 |
| `src/components/admin/restaurants-table.tsx` | L124-132 |
| `src/components/admin/restaurants-table.tsx` | L106-110 |
| `src/components/admin/restaurants-table.tsx` | L149-196 |
| `src/components/admin/restaurants-table.tsx` | L1124-1156 |
| `src/components/admin/restaurants-table.tsx` | L586-640 |
| `src/components/admin/deals/deals-table.tsx` | L288-314 |
| `src/components/admin/restaurants-table.tsx` | L822-883 |
| `src/components/admin/restaurants-table.tsx` | L84-106 |

</details>

---

Read file: src/types/db.ts

---

```diff
  'use client'
  
- import {useState, useEffect} from 'react'
+ import {useState, useEffect, useMemo} from 'react'
  import Link from 'next/link'
  import Image from 'next/image'
```

```diff
    FileSpreadsheet,
    Upload,
+   ChevronDown,
+   ChevronLeft,
+   ChevronRight,
+   ChevronsLeft,
+   ChevronsRight,
  } from 'lucide-react'
  import type {Deal} from '@/types/db'
```

```diff
  import {CSVUpload} from '@/components/admin/csv-upload'
  import {importDealsFromCSV} from '@/actions/deals'
+ import {
+   flexRender,
+   getCoreRowModel,
+   getSortedRowModel,
+   getPaginationRowModel,
+   useReactTable,
+   type ColumnDef,
+   type SortingState,
+ } from '@tanstack/react-table'
  import {
    AlertDialog,
```

```diff
    DropdownMenuTrigger,
  } from '@/components/ui/dropdown-menu'
+ import {
+   Table,
+   TableBody,
+   TableCell,
+   TableHead,
+   TableHeader,
+   TableRow,
+ } from '@/components/ui/table'
  import {Button} from '@/components/ui/button'
  import {cn} from '@/lib/utils'
```

```diff
  }
  
- export function DealsTable({deals}: {deals: DealWithRestaurant[]}) {
+ export function DealsTable({
+   deals: initialDeals,
+ }: {
+   deals: DealWithRestaurant[]
+ }) {
    const [isDeleting, setIsDeleting] = useState<bigint | null>(null)
    const [showDeleteConfirm, setShowDeleteConfirm] = useState(false)
```

```diff
    const [isExporting, setIsExporting] = useState(false)
    const [isImporting, setIsImporting] = useState(false)
+   const [sorting, setSorting] = useState<SortingState>([])
+   const [pagination, setPagination] = useState({
+     pageIndex: 0,
+     pageSize: 10,
+   })
    const router = useRouter()
+ 
+   // Memoize data for TanStack Table to avoid recreating on every render
+   const data = useMemo(() => initialDeals, [initialDeals])
  
    // Check viewport size on mount and window resize
```

```diff
  
        // Create a clean export data structure with only the fields we want
-       const exportData = deals.map((deal) => ({
+       const exportData = data.map((deal) => ({
          id: deal.id.toString(),
          title: deal.title,
```

```diff
        exportToCSV(exportData, 'deals-export')
  
-       toast.success(`Successfully exported ${deals.length} deals to CSV`)
+       toast.success(`Successfully exported ${data.length} deals to CSV`)
      } catch (error) {
        console.error('Error exporting CSV:', error)
```

```diff
      }
    }
+ 
+   // Define table columns
+   const columns = useMemo<ColumnDef<DealWithRestaurant>[]>(
+     () => [
+       {
+         accessorKey: 'title',
+         header: ({column}) => (
+           <div className='flex items-center'>
+             <span>Deal</span>
+             <Button
+               variant='ghost'
+               size='sm'
+               className='ml-1 h-8 w-8 p-0'
+               onClick={() =>
+                 column.toggleSorting(column.getIsSorted() === 'asc')
+               }
+             >
+               <ChevronDown className='h-4 w-4' />
+             </Button>
+           </div>
+         ),
+         cell: ({row}) => {
+           const deal = row.original
+           return (
+             <div className='flex items-center space-x-3'>
+               <div className='h-10 w-10 flex-shrink-0 relative overflow-hidden rounded-md'>
+                 {deal.imageUrl ? (
+                   <Image
+                     src={deal.imageUrl}
+                     alt={deal.title}
+                     fill
+                     className='object-cover'
+                   />
+                 ) : (
+                   <div className='h-full w-full bg-gray-200 flex items-center justify-center'>
+                     <span className='text-gray-500 text-xs'>No image</span>
+                   </div>
+                 )}
+               </div>
+               <div>
+                 <p className='font-medium text-gray-900'>{deal.title}</p>
+                 <p className='text-sm text-gray-500 truncate max-w-[200px]'>
+                   {deal.content}
+                 </p>
+               </div>
+             </div>
+           )
+         },
+       },
+       {
+         accessorKey: 'restaurant.name',
+         header: ({column}) => (
+           <div className='flex items-center'>
+             <span>Restaurant</span>
+             <Button
+               variant='ghost'
+               size='sm'
+               className='ml-1 h-8 w-8 p-0'
+               onClick={() =>
+                 column.toggleSorting(column.getIsSorted() === 'asc')
+               }
+             >
+               <ChevronDown className='h-4 w-4' />
+             </Button>
+           </div>
+         ),
+         cell: ({row}) => (
+           <span className='font-medium'>{row.original.restaurant?.name}</span>
+         ),
+       },
+       {
+         accessorKey: 'active',
+         header: ({column}) => (
+           <div className='flex items-center'>
+             <span>Status</span>
+             <Button
+               variant='ghost'
+               size='sm'
+               className='ml-1 h-8 w-8 p-0'
+               onClick={() =>
+                 column.toggleSorting(column.getIsSorted() === 'asc')
+               }
+             >
+               <ChevronDown className='h-4 w-4' />
+             </Button>
+           </div>
+         ),
+         cell: ({row}) => {
+           const isActive = row.original.active
+           return (
+             <span
+               className={`inline-flex rounded-full px-2 text-xs font-semibold leading-5 ${
+                 isActive
+                   ? 'bg-green-100 text-green-800'
+                   : 'bg-red-100 text-red-800'
+               }`}
+             >
+               {isActive ? 'Active' : 'Inactive'}
+             </span>
+           )
+         },
+       },
+       {
+         accessorKey: 'createdAt',
+         header: ({column}) => (
+           <div className='flex items-center'>
+             <span>Created</span>
+             <Button
+               variant='ghost'
+               size='sm'
+               className='ml-1 h-8 w-8 p-0'
+               onClick={() =>
+                 column.toggleSorting(column.getIsSorted() === 'asc')
+               }
+             >
+               <ChevronDown className='h-4 w-4' />
+             </Button>
+           </div>
+         ),
+         cell: ({row}) => (
+           <span className='text-sm text-gray-500'>
+             {new Date(row.original.createdAt).toLocaleDateString()}
+           </span>
+         ),
+       },
+       {
+         accessorKey: 'updatedAt',
+         header: ({column}) => (
+           <div className='flex items-center'>
+             <span>Last Updated</span>
+             <Button
+               variant='ghost'
+               size='sm'
+               className='ml-1 h-8 w-8 p-0'
+               onClick={() =>
+                 column.toggleSorting(column.getIsSorted() === 'asc')
+               }
+             >
+               <ChevronDown className='h-4 w-4' />
+             </Button>
+           </div>
+         ),
+         cell: ({row}) => (
+           <span className='text-sm text-gray-500'>
+             {new Date(row.original.updatedAt).toLocaleDateString()}
+           </span>
+         ),
+       },
+       {
+         id: 'actions',
+         cell: ({row}) => {
+           const deal = row.original
+           return (
+             <div className='flex justify-end space-x-2'>
+               <Link
+                 href={`/admin/deals/${deal.id}`}
+                 className='rounded p-1 text-gray-500 hover:bg-gray-100 hover:text-gray-700'
+                 title='View'
+               >
+                 <Eye size={18} />
+               </Link>
+               <Link
+                 href={`/admin/deals/${deal.id}/edit`}
+                 className='rounded p-1 text-blue-500 hover:bg-blue-100 hover:text-blue-700'
+                 title='Edit'
+               >
+                 <Edit size={18} />
+               </Link>
+               <button
+                 type='button'
+                 onClick={() => handleDelete(deal.id)}
+                 disabled={isDeleting === deal.id}
+                 className='rounded p-1 text-red-500 hover:bg-red-100 hover:text-red-700 disabled:opacity-50'
+                 title='Delete'
+               >
+                 <Trash2 size={18} />
+               </button>
+             </div>
+           )
+         },
+       },
+     ],
+     [isDeleting]
+   )
+ 
+   // Create TanStack table instance
+   const table = useReactTable({
+     data,
+     columns,
+     state: {
+       sorting,
+       pagination,
+     },
+     onSortingChange: setSorting,
+     onPaginationChange: setPagination,
+     getCoreRowModel: getCoreRowModel(),
+     getSortedRowModel: getSortedRowModel(),
+     getPaginationRowModel: getPaginationRowModel(),
+     manualPagination: false,
+   })
  
    // Mobile card view for deals
    const renderMobileCards = () => {
-     return deals.length > 0 ? (
+     return data.length > 0 ? (
        <div className='space-y-4'>
-         {deals.map((deal) => (
+         {data.map((deal) => (
            <div
              key={String(deal.id)}
```

```diff
            variant='outline'
            onClick={handleExportCSV}
-           disabled={isExporting || deals.length === 0}
+           disabled={isExporting || data.length === 0}
            className='h-8 rounded-lg bg-background hover:bg-gray-100'
          >
```

```diff
        </div>
  
-       {/* Desktop table view */}
+       {/* Desktop table view with TanStack Table */}
        <div className={cn(isMobileView ? 'hidden' : 'block')}>
          <div className='w-full overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm'>
            <div className='overflow-x-auto'>
-             <table className='w-full min-w-full divide-y divide-gray-200'>
-               <thead className='bg-gray-50 text-xs font-medium uppercase text-gray-500'>
-                 <tr>
-                   <th scope='col' className='px-6 py-3 text-left'>
-                     Deal
-                   </th>
-                   <th scope='col' className='px-6 py-3 text-left'>
-                     Restaurant
-                   </th>
-                   <th scope='col' className='px-6 py-3 text-left'>
-                     Status
-                   </th>
-                   <th scope='col' className='px-6 py-3 text-left'>
-                     Created
-                   </th>
-                   <th scope='col' className='px-6 py-3 text-left'>
-                     Last Updated
-                   </th>
-                   <th scope='col' className='px-6 py-3 text-right'>
-                     Actions
-                   </th>
-                 </tr>
-               </thead>
-               <tbody className='divide-y divide-gray-200 bg-white'>
-                 {deals.length > 0 ? (
-                   deals.map((deal) => (
-                     <tr key={String(deal.id)} className='hover:bg-gray-50'>
-                       <td className='whitespace-nowrap px-6 py-4'>
-                         <div className='flex items-center space-x-3'>
-                           <div className='h-10 w-10 flex-shrink-0 relative overflow-hidden rounded-md'>
-                             {deal.imageUrl ? (
-                               <Image
-                                 src={deal.imageUrl}
-                                 alt={deal.title}
-                                 fill
-                                 className='object-cover'
-                               />
-                             ) : (
-                               <div className='h-full w-full bg-gray-200 flex items-center justify-center'>
-                                 <span className='text-gray-500 text-xs'>
-                                   No image
-                                 </span>
-                               </div>
+             <Table>
+               <TableHeader>
+                 {table.getHeaderGroups().map((headerGroup) => (
+                   <TableRow key={headerGroup.id}>
+                     {headerGroup.headers.map((header) => (
+                       <TableHead
+                         key={header.id}
+                         className='px-6 py-3 text-left'
+                       >
+                         {header.isPlaceholder
+                           ? null
+                           : flexRender(
+                               header.column.columnDef.header,
+                               header.getContext()
                              )}
-                           </div>
-                           <div>
-                             <p className='font-medium text-gray-900'>
-                               {deal.title}
-                             </p>
-                             <p className='text-sm text-gray-500 truncate max-w-[200px]'>
-                               {deal.content}
-                             </p>
-                           </div>
-                         </div>
-                       </td>
-                       <td className='whitespace-nowrap px-6 py-4'>
-                         <span className='font-medium'>
-                           {deal.restaurant?.name}
-                         </span>
-                       </td>
-                       <td className='whitespace-nowrap px-6 py-4'>
-                         <span
-                           className={`inline-flex rounded-full px-2 text-xs font-semibold leading-5 ${
-                             deal.active
-                               ? 'bg-green-100 text-green-800'
-                               : 'bg-red-100 text-red-800'
-                           }`}
-                         >
-                           {deal.active ? 'Active' : 'Inactive'}
-                         </span>
-                       </td>
-                       <td className='whitespace-nowrap px-6 py-4 text-sm text-gray-500'>
-                         {new Date(deal.createdAt).toLocaleDateString()}
-                       </td>
-                       <td className='whitespace-nowrap px-6 py-4 text-sm text-gray-500'>
-                         {new Date(deal.updatedAt).toLocaleDateString()}
-                       </td>
-                       <td className='whitespace-nowrap px-6 py-4 text-right text-sm font-medium'>
-                         <div className='flex justify-end space-x-2'>
-                           <Link
-                             href={`/admin/deals/${deal.id}`}
-                             className='rounded p-1 text-gray-500 hover:bg-gray-100 hover:text-gray-700'
-                             title='View'
-                           >
-                             <Eye size={18} />
-                           </Link>
-                           <Link
-                             href={`/admin/deals/${deal.id}/edit`}
-                             className='rounded p-1 text-blue-500 hover:bg-blue-100 hover:text-blue-700'
-                             title='Edit'
-                           >
-                             <Edit size={18} />
-                           </Link>
-                           <button
-                             type='button'
-                             onClick={() => handleDelete(deal.id)}
-                             disabled={isDeleting === deal.id}
-                             className='rounded p-1 text-red-500 hover:bg-red-100 hover:text-red-700 disabled:opacity-50'
-                             title='Delete'
-                           >
-                             <Trash2 size={18} />
-                           </button>
-                         </div>
-                       </td>
-                     </tr>
+                       </TableHead>
+                     ))}
+                   </TableRow>
+                 ))}
+               </TableHeader>
+               <TableBody>
+                 {table.getRowModel().rows?.length ? (
+                   table.getRowModel().rows.map((row) => (
+                     <TableRow key={row.id} className='hover:bg-gray-50'>
+                       {row.getVisibleCells().map((cell) => (
+                         <TableCell key={cell.id} className='px-6 py-4'>
+                           {flexRender(
+                             cell.column.columnDef.cell,
+                             cell.getContext()
+                           )}
+                         </TableCell>
+                       ))}
+                     </TableRow>
                    ))
                  ) : (
-                   <tr>
-                     <td
-                       colSpan={6}
+                   <TableRow>
+                     <TableCell
+                       colSpan={columns.length}
                        className='px-6 py-4 text-center text-sm text-gray-500'
                      >
```

```diff
                          Create one
                        </Link>
-                     </td>
-                   </tr>
+                     </TableCell>
+                   </TableRow>
                  )}
-               </tbody>
-             </table>
+               </TableBody>
+             </Table>
            </div>
  
-           {/* Pagination - simplified for mobile friendliness */}
+           {/* Pagination controls */}
            <div className='border-t border-gray-200 px-4 py-3 sm:px-6'>
-             <div className='flex flex-1 justify-between'>
-               <div>
-                 <p className='text-sm text-gray-700'>
-                   Showing <span className='font-medium'>{deals.length}</span>{' '}
-                   results
-                 </p>
+             <div className='flex flex-1 justify-between items-center'>
+               <div className='flex items-center space-x-2'>
+                 <span className='text-xs text-gray-700'>Rows per page:</span>
+                 <select
+                   value={table.getState().pagination.pageSize}
+                   onChange={(e) => {
+                     table.setPageSize(Number(e.target.value))
+                   }}
+                   className='h-8 text-xs rounded-md border border-gray-300 bg-background px-2'
+                 >
+                   {[5, 10, 20, 50].map((pageSize) => (
+                     <option key={pageSize} value={pageSize}>
+                       {pageSize}
+                     </option>
+                   ))}
+                 </select>
                </div>
-               <div>
+ 
+               <div className='flex items-center'>
+                 <span className='text-sm text-gray-700 mr-4'>
+                   Page{' '}
+                   <span className='font-medium'>
+                     {table.getState().pagination.pageIndex + 1}
+                   </span>{' '}
+                   of <span className='font-medium'>{table.getPageCount()}</span>
+                 </span>
                  <nav
                    className='isolate inline-flex -space-x-px rounded-md shadow-sm'
                    aria-label='Pagination'
                  >
-                   <button
-                     type='button'
-                     className='relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0'
+                   <Button
+                     variant='outline'
+                     size='icon'
+                     className='rounded-l-md'
+                     onClick={() => table.setPageIndex(0)}
+                     disabled={!table.getCanPreviousPage()}
                    >
-                     <span className='sr-only'>Previous</span>
-                     &laquo;
-                   </button>
-                   <button
-                     type='button'
-                     aria-current='page'
-                     className='relative z-10 inline-flex items-center bg-[#818cf8] px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600'
-                   >
-                     1
-                   </button>
-                   <button
-                     type='button'
-                     className='relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0'
+                     <span className='sr-only'>First page</span>
+                     <ChevronsLeft className='h-4 w-4' />
+                   </Button>
+                   <Button
+                     variant='outline'
+                     size='icon'
+                     onClick={() => table.previousPage()}
+                     disabled={!table.getCanPreviousPage()}
+                   >
+                     <span className='sr-only'>Previous page</span>
+                     <ChevronLeft className='h-4 w-4' />
+                   </Button>
+                   <Button
+                     variant='outline'
+                     size='icon'
+                     onClick={() => table.nextPage()}
+                     disabled={!table.getCanNextPage()}
+                   >
+                     <span className='sr-only'>Next page</span>
+                     <ChevronRight className='h-4 w-4' />
+                   </Button>
+                   <Button
+                     variant='outline'
+                     size='icon'
+                     className='rounded-r-md'
+                     onClick={() => table.setPageIndex(table.getPageCount() - 1)}
+                     disabled={!table.getCanNextPage()}
                    >
-                     <span className='sr-only'>Next</span>
-                     &raquo;
-                   </button>
+                     <span className='sr-only'>Last page</span>
+                     <ChevronsRight className='h-4 w-4' />
+                   </Button>
                  </nav>
                </div>
```

---

I've implemented TanStack React Table in the DealsTable component to replace the existing table implementation, while maintaining all functionality including mobile view, CSV export/import, and deletion capabilities. Here are the key improvements:

1. The table now provides interactive sorting for all columns
2. Full pagination implementation with pagination controls
3. Configurable page size selection
4. Proper typed column definitions
5. Optimized rendering with useMemo for data and columns

The implementation leverages TanStack's core features:
- `getCoreRowModel` - manages the base row display logic
- `getSortedRowModel` - adds column sorting functionality
- `getPaginationRowModel` - handles page-based data display

The UI maintains the same look and feel but adds enhanced user controls for sorting and navigating through multiple pages of deals data. The mobile card view continues to work as before, with the responsive breakpoint at 768px.

---

