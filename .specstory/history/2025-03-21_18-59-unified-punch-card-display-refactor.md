<!-- Generated by SpecStory -->

# Unified Punch Card Display Refactor (2025-03-21 13:59:47)

_**User**_

Refactor this file and this file only to display a single punch card  display for the user and all of the restaurants they have earned a punch for. If a punch card exists for the user and any restaurant, it should render the UI formerly responsible for displaying punches or total punches per restaurant. There should not be a Separate punch card display for each instance of a relationship between a user and a restaurant . Is that clear? 

---

_**Assistant**_



---

```diff
  export const PUNCH_THRESHOLD = 10
  
- interface PunchCardProps
-   extends Omit<React.ComponentProps<typeof motion.div>, 'ref'> {
+ // Type for a single restaurant punch record
+ export interface RestaurantPunch {
+   restaurantId: string | number | bigint
    restaurantName: string
    restaurantImage?: string
-   restaurantId: string | number | bigint
    currentPunches: number
    totalPunches?: number
    completed?: boolean
    lastUpdated?: Date | string
-   onAddPunch?: () => void
+ }
+ 
+ interface PunchCardProps
+   extends Omit<React.ComponentProps<typeof motion.div>, 'ref'> {
+   restaurants: RestaurantPunch[]
+   onAddPunch?: (restaurantId: string | number | bigint) => void
+   userName?: string
  }
  
  const PunchCard = React.forwardRef<HTMLDivElement, PunchCardProps>(
-   (
-     {
-       className,
+   ({className, restaurants, onAddPunch, userName, ...props}, ref) => {
+     return (
+       <motion.div
+         ref={ref}
+         initial={{opacity: 0, y: 20}}
+         animate={{opacity: 1, y: 0}}
+         transition={{duration: 0.5}}
+         className={cn(
+           'relative overflow-hidden rounded-xl bg-card shadow-lg',
+           'w-full flex flex-col',
+           className
+         )}
+         style={{perspective: 1000}}
+         {...props}
+       >
+         {/* Card Header */}
+         <div className='relative h-36 sm:h-48 w-full bg-gradient-to-r from-primary/80 to-primary'>
+           <div className='absolute inset-0 bg-gradient-to-t from-black/70 to-transparent' />
+ 
+           <div className='absolute bottom-0 w-full p-4'>
+             <h3 className='text-lg sm:text-xl font-bold text-white'>
+               {userName ? `${userName}'s Punch Card` : 'Your Punch Card'}
+             </h3>
+             <p className='text-xs text-white/70'>
+               Collect punches from your favorite restaurants
+             </p>
+           </div>
+         </div>
+ 
+         {/* Restaurant List */}
+         <div className='flex flex-col p-4 sm:p-6'>
+           <h4 className='text-base font-medium mb-4'>Your Restaurants</h4>
+ 
+           {restaurants.length === 0 ? (
+             <div className='py-8 text-center text-muted-foreground'>
+               You haven't earned any punches yet. Visit a restaurant to get
+               started!
+             </div>
+           ) : (
+             <div className='space-y-4'>
+               {restaurants.map((restaurant) => (
+                 <RestaurantPunchItem
+                   key={restaurant.restaurantId}
+                   restaurant={restaurant}
+                   onAddPunch={onAddPunch}
+                 />
+               ))}
+             </div>
+           )}
+         </div>
+       </motion.div>
+     )
+   }
+ )
+ 
+ PunchCard.displayName = 'PunchCard'
+ 
+ // Sub-component for individual restaurant punch items
+ interface RestaurantPunchItemProps {
+   restaurant: RestaurantPunch
+   onAddPunch?: (restaurantId: string | number | bigint) => void
+ }
+ 
+ const RestaurantPunchItem: React.FC<RestaurantPunchItemProps> = ({
+   restaurant,
+   onAddPunch,
+ }) => {
+   const [isAnimating, setIsAnimating] = React.useState(false)
+   const [punchPosition, setPunchPosition] = React.useState({x: 0, y: 0})
+   const buttonRef = React.useRef<HTMLButtonElement>(null)
+ 
+   const {
+     restaurantId,
      restaurantName,
      restaurantImage,
-       restaurantId,
      currentPunches,
      totalPunches = PUNCH_THRESHOLD,
      completed = false,
      lastUpdated,
-       onAddPunch,
-       ...props
-     },
-     ref
-   ) => {
-     const [isAnimating, setIsAnimating] = React.useState(false)
-     const [punchPosition, setPunchPosition] = React.useState({x: 0, y: 0})
-     const buttonRef = React.useRef<HTMLButtonElement>(null)
+   } = restaurant
  
    const handleAddPunch = (
-       e:
-         | React.MouseEvent<HTMLButtonElement>
-         | React.TouchEvent<HTMLButtonElement>
+     e: React.MouseEvent<HTMLButtonElement> | React.TouchEvent<HTMLButtonElement>
    ) => {
      if (currentPunches >= totalPunches || isAnimating || completed) return
```

```diff
      setTimeout(() => {
        setIsAnimating(false)
-         onAddPunch?.()
+       onAddPunch?.(restaurantId)
      }, 800)
    }
```

```diff
  
    return (
-       <motion.div
-         ref={ref}
-         initial={{opacity: 0, y: 20}}
-         animate={{opacity: 1, y: 0}}
-         transition={{duration: 0.5}}
-         whileHover={{y: -5}}
-         className={cn(
-           'relative overflow-hidden rounded-xl bg-card shadow-lg',
-           'w-full h-full flex flex-col',
-           className
-         )}
-         style={{perspective: 1000}}
-         {...props}
-       >
-         {/* Restaurant Image */}
-         <div className='relative h-36 sm:h-48 w-full'>
+     <div className='rounded-lg border border-border bg-card/50 hover:bg-card/80 transition-colors p-4'>
+       <div className='flex items-center gap-3 mb-3'>
+         <div className='relative w-12 h-12 rounded-md overflow-hidden flex-shrink-0'>
            <Image
-             src={'/RWP.jpg'}
-             alt={`${restaurantName}`}
+             src={restaurantImage || '/RWP.jpg'}
+             alt={restaurantName}
              fill
              className='object-cover'
-             sizes='(max-width: 640px) 100vw, (max-width: 768px) 50vw, 33vw'
-             priority
-           />
- 
-           <div className='absolute inset-0 bg-gradient-to-t from-black/70 to-transparent' />
- 
-           {/* Restaurant Info Overlay */}
-           <div className='absolute bottom-0 w-full p-4'>
-             <h3 className='text-lg sm:text-xl font-bold text-white'>
-               {restaurantName}
-             </h3>
-             {lastUpdated && (
-               <p className='text-xs text-white/70'>
-                 Last updated: {formatDate(lastUpdated)}
-               </p>
-             )}
-           </div>
+           />
          </div>
  
-         {/* Punch Card Content */}
-         <div className='flex flex-col flex-grow p-4 sm:p-6'>
-           <div className='flex justify-between items-center mb-3'>
-             <span className='text-sm sm:text-base font-medium text-foreground'>
-               {currentPunches} of {totalPunches} punches
-             </span>
+         <div className='flex-grow'>
+           <div className='flex justify-between items-center'>
+             <h5 className='font-medium text-foreground'>{restaurantName}</h5>
              {completed && (
                <Badge
```

```diff
            </div>
  
-           {/* Punch Grid - Adaptive grid layout based on screen size */}
-           <div
-             className={cn(
-               'grid gap-2 mb-5',
-               totalPunches <= 5
-                 ? 'grid-cols-5'
-                 : totalPunches <= 8
-                 ? 'grid-cols-4'
-                 : 'grid-cols-5'
-             )}
-           >
+           {lastUpdated && (
+             <p className='text-xs text-muted-foreground'>
+               Last updated: {formatDate(lastUpdated)}
+             </p>
+           )}
+         </div>
+       </div>
+ 
+       <div className='flex items-center gap-3 mt-2'>
+         <div className='flex-grow space-y-1'>
+           <div className='text-xs text-muted-foreground'>
+             {currentPunches} of {totalPunches} punches
+           </div>
+ 
+           {/* Punch indicators as horizontal dots */}
+           <div className='flex gap-1'>
              {Array.from({length: totalPunches}).map((_, index) => (
                <motion.div
-                 key={`punch-${index}-${
-                   currentPunches > index ? 'filled' : 'empty'
-                 }`}
+                 key={`punch-${restaurantId}-${index}`}
                  className={cn(
-                   'aspect-square rounded-lg border-2 flex items-center justify-center',
-                   index < currentPunches
-                     ? 'bg-primary/10 border-primary'
-                     : 'bg-muted/50 border-muted'
+                   'h-2 rounded-full',
+                   index < currentPunches ? 'bg-primary w-2' : 'bg-muted w-2'
                  )}
                  initial={false}
                  animate={
                    index === currentPunches - 1 && isAnimating
-                     ? {scale: [1, 1.2, 1], rotate: [0, 15, 0]}
+                     ? {scale: [1, 1.5, 1]}
                      : {}
                  }
```

```diff
                        delay: index === currentPunches - 1 ? 0.2 : 0,
                      }}
-                   >
-                     <Stamp className='h-5 w-5 text-primary' />
-                   </motion.div>
+                   />
                  )}
                </motion.div>
              ))}
+           </div>
          </div>
  
-           {/* Action Buttons */}
-           <div className='mt-auto flex flex-col sm:flex-row gap-3'>
+         <div className='flex gap-2'>
            {!completed ? (
              <motion.button
                ref={buttonRef}
-                 className='py-3 px-4 rounded-lg bg-secondary text-secondary-foreground font-medium relative overflow-hidden w-full flex-1 touch-manipulation text-base'
+               className='py-2 px-3 rounded-md bg-secondary text-secondary-foreground font-medium relative overflow-hidden touch-manipulation text-sm'
                whileHover={{scale: 1.02}}
                whileTap={{scale: 0.98}}
```

```diff
                        left: punchPosition.x,
                        top: punchPosition.y,
-                         width: 10,
-                         height: 10,
+                       width: 8,
+                       height: 8,
                      }}
                      initial={{scale: 0, opacity: 1}}
                      animate={{
-                         scale: 20,
+                       scale: 15,
                        opacity: 0,
                      }}
```

```diff
            ) : (
              <motion.button
-                 className='py-3 px-4 rounded-lg bg-green-600 text-white font-medium flex items-center justify-center gap-2 flex-1 text-base touch-manipulation'
+               className='py-2 px-3 rounded-md bg-green-600 text-white font-medium flex items-center justify-center gap-1 text-sm touch-manipulation'
                whileHover={{scale: 1.02}}
                whileTap={{scale: 0.98}}
              >
-                 <Award className='h-5 w-5' />
-                 <span>Claim Reward</span>
+               <Award className='h-4 w-4' />
+               <span>Claim</span>
              </motion.button>
            )}
  
            <Link
              href={`/restaurants/${restaurantId}`}
-               className='py-3 px-4 rounded-lg border border-border bg-background hover:bg-muted transition-colors flex items-center justify-center text-base touch-manipulation min-h-[44px]'
+             className='py-2 px-3 rounded-md border border-border bg-background hover:bg-muted transition-colors flex items-center justify-center text-sm touch-manipulation'
            >
-               View Restaurant
+             View
            </Link>
          </div>
        </div>
-       </motion.div>
+     </div>
    )
  }
- )
- 
- PunchCard.displayName = 'PunchCard'
  
  export {PunchCard}
```

---

```diff
              {Array.from({length: totalPunches}).map((_, index) => (
                <motion.div
-                 key={`punch-${restaurantId}-${index}`}
+                 key={`punch-${restaurantId}-${index}-${
+                   currentPunches > index ? 'filled' : 'empty'
+                 }`}
                  className={cn(
                    'h-2 rounded-full',
```

---

I've refactored the PunchCard component to display a consolidated view of all restaurants where a user has earned punches. The key changes include:

1. Created a `RestaurantPunch` interface to represent each restaurant's punch data
2. Modified `PunchCardProps` to accept an array of restaurants instead of a single restaurant
3. Added a card header showing the user's name and a description
4. Created a `RestaurantPunchItem` component to display each restaurant entry with:
   - Restaurant image and name
   - Punch progress indicators
   - Action buttons (Add Punch, Claim Reward, View Restaurant)
5. Implemented a compact punch indicator using horizontal dots
6. Added a message for when the user hasn't earned any punches yet

Now the component displays all restaurants in a single card, with each restaurant showing its punch progress in a compact, list-like format. The same functionality for adding punches and claiming rewards is preserved, but in a more consolidated view.

---

