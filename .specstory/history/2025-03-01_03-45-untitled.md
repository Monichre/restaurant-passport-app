<!-- Generated by SpecStory -->

# Untitled (2025-02-28 21:45:01)

_**User**_

Implement a streamText method from openai with a web search to search for a restaurants webpage and gather data on its location, website, download images and get yelp reviews

---

_**Assistant**_

<think>The user wants me to implement a `streamText` method using OpenAI with web search functionality to gather information about restaurants. This appears to be in the context of their restaurant passport app, where they want to search for a restaurant's webpage and gather data including:

1. Location information
2. Website URL
3. Download images
4. Get Yelp reviews

Looking at the file path in the request (`src/app/api/ai/enrich/restaurant/route.ts`), this suggests a Next.js API route that will handle enriching restaurant data with AI-powered web search.

Let me create a detailed implementation for this route. I'll need to:

1. Set up an OpenAI client
2. Create a streaming endpoint
3. Use web search to gather restaurant information
4. Process and return the results

First, I'll need to check what dependencies might already exist in the project, but based on the user's context, I'll assume they're using Next.js and would like to implement this in TypeScript.</think>I'll implement a `streamText` method for OpenAI with web search to gather restaurant data. This will be a Next.js API route that searches for restaurant information, processes it, and returns enriched data.

Let me create the implementation:

---

```diff
- 
+ import { OpenAI } from 'openai';
+ import { StreamingTextResponse, OpenAIStream } from 'ai';
+ import { NextRequest, NextResponse } from 'next/server';
+ import { z } from 'zod';
+ 
+ // Schema for validating request body
+ const requestSchema = z.object({
+   restaurantName: z.string().min(1, "Restaurant name is required"),
+   location: z.string().optional(),
+ });
+ 
+ // Type for the restaurant data
+ type RestaurantData = {
+   name: string;
+   address?: string;
+   website?: string;
+   phone?: string;
+   rating?: number;
+   reviews?: string[];
+   images?: string[];
+   hours?: Record<string, string>;
+   cuisine?: string[];
+   priceRange?: string;
+ };
+ 
+ const openai = new OpenAI({
+   apiKey: process.env.OPENAI_API_KEY,
+ });
+ 
+ export const runtime = 'edge';
+ 
+ export async function POST(req: NextRequest) {
+   try {
+     // Parse and validate request body
+     const body = await req.json();
+     const result = requestSchema.safeParse(body);
+     
+     if (!result.success) {
+       return NextResponse.json({ error: result.error }, { status: 400 });
+     }
+ 
+     const { restaurantName, location } = result.data;
+     
+     // Construct search query
+     const searchQuery = location 
+       ? `${restaurantName} restaurant in ${location}`
+       : `${restaurantName} restaurant`;
+     
+     // Perform web search
+     const searchResponse = await openai.chat.completions.create({
+       model: "gpt-4-turbo",
+       stream: true,
+       messages: [
+         {
+           role: "system",
+           content: `You are a restaurant data researcher assistant. Your task is to search for and compile comprehensive information about a restaurant.
+           Return the data in a structured JSON format with the following fields:
+           - name: The restaurant's name
+           - address: Full address
+           - website: Official website URL
+           - phone: Contact phone number
+           - rating: Overall rating (0-5)
+           - reviews: Array of up to 5 notable customer reviews
+           - images: Array of image URLs related to the restaurant
+           - hours: Object with days of the week and operating hours
+           - cuisine: Array of cuisine types
+           - priceRange: Price category (e.g., "$", "$$", "$$$", "$$$$")
+           
+           If any information is unavailable, omit that field. Be thorough and accurate.`
+         },
+         {
+           role: "user", 
+           content: `Search for information about "${searchQuery}" and provide comprehensive details.`
+         }
+       ],
+       tools: [
+         {
+           type: "function",
+           function: {
+             name: "search_web",
+             description: "Search the web for restaurant information",
+             parameters: {
+               type: "object",
+               properties: {
+                 query: {
+                   type: "string",
+                   description: "The search query"
+                 }
+               },
+               required: ["query"]
+             }
+           }
+         }
+       ],
+       tool_choice: "auto"
+     });
+ 
+     // Create a streaming response
+     const stream = OpenAIStream(searchResponse, {
+       onCompletion: async (completion) => {
+         // Optional: Log or process the complete response when done
+         console.log("Restaurant data enrichment complete");
+       },
+     });
+ 
+     // Return a streaming response
+     return new StreamingTextResponse(stream);
+     
+   } catch (error) {
+     console.error("Error enriching restaurant data:", error);
+     return NextResponse.json(
+       { error: "Failed to enrich restaurant data" },
+       { status: 500 }
+     );
+   }
+ }
+ 
```

---



Now I need to install the required dependencies to fix the linting errors. Let's add the OpenAI and the 'ai' Vercel packages:

---

Cancelled

---



---

