<!-- Generated by SpecStory -->

# Hydration Error: Invalid HTML Structure (2025-04-14 08:17:07)

_**User**_

In HTML, <td> cannot be a child of <div>.
This will cause a hydration error.

See more info here: https://nextjs.org/docs/messages/react-hydration-error


...
    <Primitive.div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«r0»..." ...>
      <div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«r0»..." ...>
        <Card>
          <div className="rounded-xl...">
            <div>
            ...
              <div className="w-full">
                <_c>
                  <div className="relative w...">
                    <table ref={null} className="w-full cap...">
                      <_c2>
                      <_c4>
                        <tbody ref={null} className={"[&_tr:la..."}>
                          <_c8 className="border-b t...">
                            <tr ref={null} className="border-bor...">
                              <motion.div initial={{opacity:0,y:10}} animate={{opacity:1,y:0}} transition={{delay:0}} ...>
>                               <div className="contents" style={{opacity:0,transform:"translateY..."}} ref={function}>
                                  <_c12 className="text-cente...">
>                                   <td
>                                     ref={null}
>                                     className={"p-3 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:..."}
>                                   >
                                  ...
                          ...
src/components/ui/table.tsx (88:2) @ _c12


  86 | 	React.TdHTMLAttributes<HTMLTableCellElement>
  87 | >(({ className, ...props }, ref) => (
> 88 | 	<td
     | 	^
  89 | 		ref={ref}
  90 | 		className={cn(
  91 | 			"p-3 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-0.5",


---

_**Assistant**_



---

Looking at the error, you have a hydration issue where a `<td>` element is incorrectly nested inside `<div>` elements within a table structure. This is an invalid HTML structure as table cells (`<td>`) must be direct children of table rows (`<tr>`).

The problem appears to be in your table component where you're using Framer Motion's `<motion.div>` between your `<tr>` and `<td>` elements. Let's examine and fix the component in `src/components/ui/table.tsx`.

---

Read file: src/components/ui/table.tsx

---

Now, let's find the component where you're using Framer Motion with the table rows.

---

<details>
            <summary>Searched codebase "motion.div table row" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/components/ui/data-table.tsx` | L1-76 |
| `src/components/leaderboard/user-leaderboard.tsx` | L62-105 |
| `src/components/leaderboard/restaurant-leaderboard.tsx` | L48-81 |
| `src/components/ui/data-table.tsx` | L76-96 |
| `src/components/leaderboard/restaurant-leaderboard.tsx` | L1-20 |
| `src/components/ui/data-table.tsx` | L96-137 |
| `src/components/motion-primitives/animated-group.tsx` | L101-141 |
| `src/components/leaderboard/user-leaderboard.tsx` | L1-19 |
| `src/components/ui/table.tsx` | L1-81 |
| `src/components/leaderboard/restaurant-leaderboard.tsx` | L81-115 |
| `src/features/users/lottery-status.tsx` | L196-240 |
| `src/components/ui/punchcard.tsx` | L103-130 |
| `src/components/ui/punchcard.tsx` | L65-103 |
| `src/features/users/lottery-status.tsx` | L151-174 |
| `src/features/users/passport/passport.tsx` | L145-183 |
| `src/components/ui/hero-parallax.tsx` | L56-102 |
| `src/features/users/lottery-status.tsx` | L174-196 |
| `src/components/icons/info-card.tsx` | L354-408 |
| `src/features/users/lottery-status.tsx` | L83-121 |
| `src/components/ui/hero-parallax.tsx` | L1-56 |
| `src/components/motion-primitives/animated-group.tsx` | L28-101 |
| `src/features/users/passport/passport.tsx` | L183-213 |
| `src/features/users/lottery-status.tsx` | L240-288 |
| `src/components/admin/restaurants-table.tsx` | L1455-1504 |
| `src/components/admin/restaurants-table.tsx` | L1223-1260 |

</details>

---

I found the issue! The problem is in your leaderboard components where you're using a `<motion.div>` with `className="contents"` between your `<TableRow>` and `<TableCell>` elements.

Let's look at both problematic components:

1. `src/components/leaderboard/user-leaderboard.tsx`
2. `src/components/leaderboard/restaurant-leaderboard.tsx`

Both have the same pattern of wrapping table cells in a `<motion.div>` inside a table row.

Let's fix the issue in `src/components/leaderboard/user-leaderboard.tsx` first:

---

Read file: src/components/leaderboard/user-leaderboard.tsx

---

Now, let's check the restaurant leaderboard component:

---

Read file: src/components/leaderboard/restaurant-leaderboard.tsx

---

Great, I found the issue in both components! Let's fix both of them. The problem is that both components have a `<motion.div>` with `className="contents"` between the `<TableRow>` and `<TableCell>` elements, which causes the invalid HTML structure.

The solution is to move the animation from the div wrapper to the individual cells or to create a custom animated table row component. Let's implement the fix for both components:

1. First, let's fix `src/components/leaderboard/user-leaderboard.tsx`:

---

```diff
- "use client";
+ 'use client'
  
- import { Avatar, AvatarFallback } from "@/components/ui/avatar";
- import { Badge } from "@/components/ui/badge";
+ import {Avatar, AvatarFallback} from '@/components/ui/avatar'
+ import {Badge} from '@/components/ui/badge'
  import {
    Table,
```

```diff
    TableHeader,
    TableRow,
- } from "@/components/ui/table";
- import { Trophy } from "lucide-react";
- import { motion } from "framer-motion";
- import type { UserLeaderboardEntry } from "@/types/api";
+ } from '@/components/ui/table'
+ import {Trophy} from 'lucide-react'
+ import {motion} from 'framer-motion'
+ import type {UserLeaderboardEntry} from '@/types/api'
  
  interface UserLeaderboardProps {
- 	users: UserLeaderboardEntry[];
+   users: UserLeaderboardEntry[]
  }
  
  // Function to get initials from name
  const getInitials = (name: string) => {
    return name
- 		.split(" ")
+     .split(' ')
      .map((n) => n[0])
- 		.join("")
- 		.toUpperCase();
- };
+     .join('')
+     .toUpperCase()
+ }
+ 
+ // Create an animated table row component
+ const AnimatedTableRow = motion(TableRow)
  
- export function UserLeaderboard({ users }: UserLeaderboardProps) {
+ export function UserLeaderboard({users}: UserLeaderboardProps) {
    // Function to get rank badge color
    const getRankBadgeColor = (rank: number) => {
      switch (rank) {
        case 1:
- 				return "bg-yellow-100 text-yellow-800 border-yellow-200";
+         return 'bg-yellow-100 text-yellow-800 border-yellow-200'
        case 2:
- 				return "bg-gray-100 text-gray-800 border-gray-200";
+         return 'bg-gray-100 text-gray-800 border-gray-200'
        case 3:
- 				return "bg-amber-100 text-amber-800 border-amber-200";
+         return 'bg-amber-100 text-amber-800 border-amber-200'
        default:
- 				return "bg-blue-100 text-blue-800 border-blue-200";
+         return 'bg-blue-100 text-blue-800 border-blue-200'
+     }
    }
- 	};
  
    return (
- 		<div className="w-full">
+     <div className='w-full'>
        <Table>
          <TableHeader>
            <TableRow>
- 						<TableHead className="w-24 text-center">Rank</TableHead>
+             <TableHead className='w-24 text-center'>Rank</TableHead>
              <TableHead>User</TableHead>
- 						<TableHead className="text-right">Punch Cards</TableHead>
+             <TableHead className='text-right'>Punch Cards</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {users.length === 0 ? (
              <TableRow>
- 							<TableCell colSpan={3} className="h-24 text-center">
+               <TableCell colSpan={3} className='h-24 text-center'>
                  No users found
                </TableCell>
              </TableRow>
            ) : (
              users.map((user, index) => (
- 							<TableRow
+               <AnimatedTableRow
                  key={user.userId.toString()}
- 								className="border-b transition-colors hover:bg-muted/50"
- 							>
- 								<motion.div
- 									initial={{ opacity: 0, y: 10 }}
- 									animate={{ opacity: 1, y: 0 }}
- 									transition={{ delay: index * 0.05 }}
- 									className="contents" // Using contents to not disrupt table layout
+                 className='border-b transition-colors hover:bg-muted/50'
+                 initial={{opacity: 0, y: 10}}
+                 animate={{opacity: 1, y: 0}}
+                 transition={{delay: index * 0.05}}
                >
- 									<TableCell className="text-center font-medium">
+                 <TableCell className='text-center font-medium'>
                    {user.rank <= 3 ? (
                      <Badge className={`${getRankBadgeColor(user.rank)}`}>
- 												{user.rank === 1 && <Trophy className="mr-1 h-3 w-3" />}
+                       {user.rank === 1 && <Trophy className='mr-1 h-3 w-3' />}
                        {user.rank}
                      </Badge>
```

```diff
                  </TableCell>
                  <TableCell>
- 										<div className="flex items-center gap-2">
- 											<Avatar className="h-8 w-8">
- 												<AvatarFallback className="bg-primary/10 text-primary">
+                   <div className='flex items-center gap-2'>
+                     <Avatar className='h-8 w-8'>
+                       <AvatarFallback className='bg-primary/10 text-primary'>
                          {getInitials(user.userName)}
                        </AvatarFallback>
                      </Avatar>
- 											<span className="font-medium">{user.userName}</span>
+                     <span className='font-medium'>{user.userName}</span>
                    </div>
                  </TableCell>
- 									<TableCell className="text-right font-medium">
+                 <TableCell className='text-right font-medium'>
                    {user.punchCardCount}
                  </TableCell>
- 								</motion.div>
- 							</TableRow>
+               </AnimatedTableRow>
              ))
            )}
          </TableBody>
        </Table>
      </div>
- 	);
+   )
  }
  
```

---

Now, let's fix the restaurant leaderboard component:

---

```diff
    restaurants: RestaurantLeaderboardEntry[]
  }
+ 
+ // Create an animated table row component
+ const AnimatedTableRow = motion(TableRow)
  
  export function RestaurantLeaderboard({
```

```diff
            ) : (
              restaurants.map((restaurant, index) => (
-               <TableRow
+               <AnimatedTableRow
                  key={restaurant.restaurantId.toString()}
                  className='border-b transition-colors hover:bg-muted/50'
-               >
-                 <motion.div
                  initial={{opacity: 0, y: 10}}
                  animate={{opacity: 1, y: 0}}
                  transition={{delay: index * 0.05}}
-                   className='contents' // Using contents to not disrupt table layout
                >
                  <TableCell className='text-center font-medium'>
                    {restaurant.rank <= 3 ? (
-                       <Badge
-                         className={`${getRankBadgeColor(restaurant.rank)}`}
-                       >
+                     <Badge className={`${getRankBadgeColor(restaurant.rank)}`}>
                        {restaurant.rank === 1 && (
                          <Trophy className='mr-1 h-3 w-3' />
```

```diff
                    {restaurant.punchCardCount}
                  </TableCell>
-                 </motion.div>
-               </TableRow>
+               </AnimatedTableRow>
              ))
            )}
```

---

I also see that there's an issue with the import in the restaurant-leaderboard.tsx file. Let's fix the incorrect import from 'motion/react':

---

```diff
  } from '@/components/ui/table'
  import {Trophy} from 'lucide-react'
- import {motion} from 'motion/react'
+ import {motion} from 'framer-motion'
  import Image from 'next/image'
  import Link from 'next/link'
```

---

Perfect! I've fixed both components by:

1. Creating a motion-animated table row component with `const AnimatedTableRow = motion(TableRow)`
2. Replacing the regular `<TableRow>` with `<AnimatedTableRow>` 
3. Moving the animation properties directly to the table row component
4. Removing the problematic `<motion.div className="contents">` wrapper
5. Fixed the incorrect import in the restaurant leaderboard component from 'motion/react' to 'framer-motion'

These changes ensure that your HTML structure is valid since now the `<td>` elements are direct children of the `<tr>` element as required by HTML standards. The animation functionality is preserved by using Framer Motion's ability to create animated versions of any component.

This should fix your hydration error as there's no longer a situation where a `<td>` is being improperly nested inside a `<div>`. The data table will now render properly while maintaining the same nice animation effects.

---

