<!-- Generated by SpecStory -->

# Generate documentation for restaurant passport app (2025-06-09 01:39:33)

_**User**_

Generate comprehensive documentation, PRD and USer flows documentation to assist in building front end intregration and selenium tests

---

_**Assistant**_

Certainly! Below is a comprehensive documentation package for your **Restaurant Passport App**. This includes a Product Requirements Document (PRD), detailed user flows, and guidance for frontend integration and Selenium E2E testing. This is tailored for engineers, QA, and automation specialists to ensure clarity, coverage, and maintainability.

---

# Restaurant Passport App – Comprehensive Documentation

---

## 1. Product Requirements Document (PRD)

### 1.1. Overview

**Restaurant Passport App** is a digital punch card and loyalty platform for restaurants, built with Next.js, TypeScript, Tailwind CSS, ShadCN/UI, Framer Motion, Storybook, Supabase (PostgreSQL), Drizzle ORM, and Clerk for authentication.  
It enables users to earn punches at restaurants, redeem prizes, enter raffles, transfer points, and view achievements. Restaurant admins and system admins manage data and analytics via protected dashboards.

---

### 1.2. Core Features

- **Digital Punch Cards:** Users earn punches at restaurants; upon reaching a threshold, they enter a raffle.
- **Role-Based Authorization:** User, Restaurant Admin, System Admin, enforced via Clerk.
- **Real-Time QR Validation:** Staff/admins scan user QR codes to add punches instantly (WebSockets).
- **Prizes & Raffles:** Prize management, redemption, and automatic raffle entry on punch card completion.
- **Points & Achievements:** Users transfer points, unlock achievements, and view real-time leaderboards.
- **Analytics Dashboard:** Restaurant-level analytics for punch cards, user activity, and prize redemptions.

---

### 1.3. Technical Stack

- **Frontend:** Next.js (TypeScript), Tailwind CSS, ShadCN/UI, Framer Motion, Storybook
- **Backend:** Next.js API routes, Supabase (PostgreSQL), Drizzle ORM
- **Auth:** Clerk (User, Restaurant Admin, System Admin roles)
- **Real-Time:** WebSockets for QR validation and leaderboard updates
- **Testing:** Jest, Vitest, Storybook, Selenium (E2E)
- **CI/CD:** GitHub Actions (recommended), Vercel for hosting

---

### 1.4. Database Schema (Drizzle ORM)

**Key Tables:**  
- `users` (with Clerk integration, roles: isStaff, isAdmin)
- `restaurants`
- `punch_cards`
- `raffle_entries`
- `prizes`
- `prize_redemptions`
- `point_balances`
- `point_transfers`
- `achievements`

**See [db/models](src/db/models/) for full schema.**

---

### 1.5. API Endpoints

**User:**  
- `POST /api/users` – create user  
- `GET /api/users/clerk/:clerkId` – get user by Clerk ID

**Restaurant:**  
- `GET /api/restaurants` – list all  
- `GET /api/restaurants/:id` – get by ID

**Punch Cards:**  
- `POST /api/punch-cards` – create  
- `POST /api/punch-cards/:id/punch` – increment  
- `GET /api/users/:userId/punch-cards` – user’s cards

**Prizes:**  
- `POST /api/prizes` – create  
- `GET /api/restaurants/:restaurantId/prizes` – list for restaurant  
- `GET /api/prizes/:id` – get by ID  
- `PATCH /api/prizes/:id` – update

**Prize Redemptions:**  
- `POST /api/prize-redemptions` – create  
- `GET /api/users/:userId/prize-redemptions` – user’s redemptions  
- `PATCH /api/prize-redemptions/:id/status` – update status

**Points & Leaderboard:**  
- `GET /api/users/:userId/points` – get balance  
- `GET /api/leaderboard` – get leaderboard  
- `POST /api/point-transfers` – transfer points  
- `GET /api/users/:userId/transfers` – transfer history  
- `GET /api/users/:userId/achievements` – achievements

**Analytics:**  
- `GET /api/restaurants/:restaurantId/analytics` – punch card & redemption analytics

**WebSocket:**  
- `ws://<server>/ws` – QR validation, leaderboard updates

---

### 1.6. Roles & Permissions

- **User:**  
  - View own profile, punch cards, achievements, transfer points
- **Restaurant Admin:**  
  - Manage prizes, analytics, punch cards for assigned restaurant(s)
- **System Admin:**  
  - Full access to all resources, manage users/restaurants

---

## 2. User Flows

### 2.1. User Onboarding & Profile

1. **Sign Up / Sign In:**  
   - User registers via Clerk  
   - Assigned default “User” role  
   - Redirected to profile/dashboard

2. **Profile Page:**  
   - Displays user info, punch cards, achievements, points

---

### 2.2. Earning Punches

1. User visits a restaurant
2. User opens their punch card (shows QR code)
3. Staff/Restaurant Admin scans QR code (via admin dashboard or staff device)
4. Punch is added in real-time (WebSocket)
5. If punch card is completed:
   - Card is marked as completed
   - Raffle entry is created automatically

---

### 2.3. Prize Redemption

1. User views available prizes for a restaurant
2. User selects a prize (if eligible)
3. System checks punch count and prize availability
4. Redemption is created, status is set (pending/redeemed)
5. User can view redemption status and history

---

### 2.4. Point Transfer & Achievements

1. User initiates a point transfer to another user
2. System checks sender’s balance
3. Points are transferred, balances updated
4. Achievements are checked/unlocked (e.g., first transfer, milestones)
5. Leaderboard updates in real-time

---

### 2.5. Admin Flows

- **Restaurant Admin:**  
  - Log in via Clerk  
  - Access admin dashboard  
  - Manage prizes, view analytics, scan QR codes, view punch cards

- **System Admin:**  
  - Manage users, assign roles, manage all restaurants and analytics

---

### 2.6. Analytics

- Restaurant Admins and System Admins can view:
  - Completed punch cards
  - Prize redemption rates
  - Active users
  - Historical activity (charts/graphs)

---

## 3. Frontend Integration Guidelines

### 3.1. Directory Structure

- **Pages:** `src/app/`
- **Components:** `src/components/`
- **Features:** `src/features/`
- **API:** `src/app/api/`
- **DB Models:** `src/db/models/`
- **Hooks:** `src/hooks/`
- **Context:** `src/context/`
- **Types:** `src/types/`
- **Utils:** `src/utils/`

### 3.2. UI/UX

- Use **Tailwind CSS** and **ShadCN/UI** for all styling and UI components
- Use **Framer Motion** for animations (e.g., punch card completion, leaderboard changes)
- Document all reusable components in **Storybook** (`src/stories/`)
- Ensure all forms and buttons are accessible (ARIA, keyboard navigation)

### 3.3. State Management

- Use React context or hooks for global state (e.g., user session, punch card state)
- Fetch data via Next.js API routes or directly from Supabase (if appropriate)
- Use SWR or React Query for data fetching/caching if needed

### 3.4. Auth & Role Checks

- Use Clerk hooks/components for authentication and role checks
- Protect admin routes/pages with role-based guards

### 3.5. Error Handling

- Show user-friendly error messages for all API failures
- Use try/catch in async functions
- Log errors to console in dev, to monitoring service in prod

### 3.6. API Usage

- Use fetch/axios to call Next.js API routes
- Always validate data with Zod schemas before sending to backend

---

## 4. Selenium E2E Test Planning

### 4.1. Test Environment

- Use a staging environment with seeded test data
- Use test Clerk/Supabase accounts with all roles

### 4.2. Test Scenarios

#### **User Flows**

- User can sign up, log in, and view profile
- User can view restaurants and punch cards
- User can display QR code for punch
- Staff/admin can scan QR and increment punch in real-time
- User can redeem a prize (if eligible)
- User can transfer points and see updated balances/achievements
- User can view leaderboard and achievements

#### **Admin Flows**

- Restaurant admin can log in, view dashboard, manage prizes
- Admin can scan QR codes and see punch card updates
- System admin can manage users and restaurants

#### **Edge Cases**

- Attempt to redeem prize with insufficient punches
- Attempt to transfer more points than available
- Access control: user cannot access admin routes, etc.

### 4.3. Selenium Test Structure

- Use **Page Object Model** for maintainability
- Use descriptive selectors (data-testid, aria-label)
- Mock or seed data for deterministic tests
- Take screenshots on failure for debugging

#### **Example Selenium Test Pseudocode**

```python
# test_user_signup_and_punch.py

def test_user_signup_and_earn_punch(driver):
    driver.get("https://staging.restaurant-passport.com/sign-up")
    driver.find_element(By.ID, "email").send_keys("testuser@example.com")
    driver.find_element(By.ID, "password").send_keys("securepassword")
    driver.find_element(By.ID, "submit").click()
    assert "Profile" in driver.title

    # Navigate to restaurants, select one
    driver.find_element(By.LINK_TEXT, "Restaurants").click()
    driver.find_element(By.CSS_SELECTOR, "[data-testid='restaurant-card-1']").click()
    driver.find_element(By.ID, "show-qr").click()
    qr_code = driver.find_element(By.ID, "user-qr-code")
    assert qr_code.is_displayed()

    # Simulate staff scanning QR (could be via API or admin UI)
    # ... (mock punch increment)
    driver.refresh()
    punch_count = driver.find_element(By.ID, "punch-count").text
    assert int(punch_count) == 1
```

---

## 5. User Stories

- **As a user**, I want to earn punches at restaurants so I can redeem prizes and enter raffles.
- **As a user**, I want to transfer points to friends and unlock achievements.
- **As a restaurant admin**, I want to manage prizes and view analytics for my restaurant.
- **As a system admin**, I want to manage all users and restaurants and see global analytics.

---

## 6. Best Practices & Conventions

- Use **functional components** and **named exports** only
- Use **all caps** for constants, **camelCase** for hooks, **PascalCase** for components
- Use **lowercase-dash** for directories and utility files
- Validate all data with **Zod** before DB/API operations
- Write **unit tests** for all business logic and **integration/E2E tests** for user flows
- Document all components and flows in **Storybook** and markdown

---

## 7. References

- [README.md](README.md) – Project intro and setup
- [src/db/models/](src/db/models/) – Drizzle ORM schemas
- [src/app/api/](src/app/api/) – API route handlers
- [src/components/](src/components/) – UI components
- [src/features/](src/features/) – Feature modules
- [src/hooks/](src/hooks/) – Custom hooks
- [src/types/](src/types/) – TypeScript types
- [src/utils/](src/utils/) – Utility functions
- [STORYBOOK_DATABASE_MOCKING_PSEUDOCODE.md](STORYBOOK_DATABASE_MOCKING_PSEUDOCODE.md) – Storybook data mocking
- [PWA.md](PWA.md) – PWA implementation plan

---

## 8. Next Steps

- Ensure all API endpoints are covered by integration tests
- Expand Storybook coverage for all UI states
- Implement Selenium E2E tests for all critical user/admin flows
- Regularly review and update documentation as features evolve

---

# End of Documentation

This documentation should provide a clear foundation for frontend engineers, QA, and automation engineers to build, test, and maintain the Restaurant Passport App.  
If you need further breakdowns (e.g., specific component contracts, more Selenium code examples, or API request/response schemas), let me know!

---

