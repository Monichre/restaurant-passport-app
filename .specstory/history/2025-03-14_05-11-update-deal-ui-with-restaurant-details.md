<!-- Generated by SpecStory -->

# Update Deal UI with Restaurant Details (2025-03-14 00:11:04)

_**User**_

Add link to the respective deal's restaurant and add its name and image to the itemized deal UI

---

_**Assistant**_

<think>Let me analyze the current code to understand what changes are needed to add a link to the respective restaurant and incorporate the restaurant's name and image into the itemized deal UI.

Currently, the `DealsList` component accepts:
1. `deals`: An array of DatabaseDeal objects
2. `restaurant`: An optional restaurant object (id, name)
3. `className`: An optional CSS class name

The DatabaseDeal interface already includes:
- `restaurantId` - The ID of the restaurant
- `name` - This might be the restaurant name (though it's optional)
- `imageUrl` - This might be for the restaurant image (though it's optional)

To implement the requested changes, I need to:
1. Update the deal card UI to display the restaurant's name and image
2. Add a link to the restaurant page for each deal

Since we already have restaurant information in each deal, I can use that. However, I need to check how the restaurant information is supposed to be displayed when the component also receives a general `restaurant` prop.

Based on the current implementation, when a `restaurant` prop is provided, it shows "Current Deals at {restaurant.name}" in the heading and displays a "View Restaurant" link at the bottom of each card. This suggests that the component can be used to show deals for a specific restaurant or for multiple restaurants.

For the updated implementation, I'll:
1. Create a section at the top of each deal card to display the restaurant name and image (when available)
2. Make sure this is only shown when we're not already in the context of a specific restaurant (i.e., when the `restaurant` prop is not provided)
3. Add a link to the respective restaurant page for each deal</think>I'll update the DealsList component to include the restaurant name, image, and link for each deal item. 

---

```diff
  						)}
  					>
+ 						{/* Show restaurant info only when not in restaurant-specific context */}
+ 						{!restaurant && deal.name && (
+ 							<Link
+ 								href={`/restaurants/${deal.restaurantId}`}
+ 								className="block"
+ 							>
+ 								<div className="flex items-center p-4 border-b border-gray-100 dark:border-zinc-800">
+ 									{deal.imageUrl && (
+ 										<div className="relative w-12 h-12 mr-3 overflow-hidden rounded-full flex-shrink-0">
+ 											<Image
+ 												src={deal.imageUrl}
+ 												alt={deal.name || "Restaurant"}
+ 												fill
+ 												className="object-cover"
+ 												sizes="48px"
+ 											/>
+ 										</div>
+ 									)}
+ 									<div>
+ 										<h4 className="font-medium text-gray-900 dark:text-gray-100 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
+ 											{deal.name}
+ 										</h4>
+ 										<p className="text-xs text-gray-500 dark:text-gray-400">
+ 											View restaurant details
+ 										</p>
+ 									</div>
+ 								</div>
+ 							</Link>
+ 						)}
+ 
  						<div className="p-5">
  							<div className="flex justify-between items-start mb-2">
```

```diff
  							</div>
  
- 							{restaurant && (
  							<div className="mt-4 flex items-center justify-between">
  								<div className="flex items-center text-sm text-gray-500 dark:text-gray-400">
```

```diff
  
  								<Link
- 										href={`/restaurants/${restaurant.id}`}
+ 									href={`/restaurants/${restaurant ? restaurant.id : deal.restaurantId}`}
  									className="inline-flex items-center text-xs font-medium text-blue-600 dark:text-blue-400 hover:underline"
  								>
  									View Restaurant <ExternalLink className="ml-1 h-3 w-3" />
  								</Link>
  							</div>
- 							)}
  						</div>
  					</motion.div>
```

---

I've successfully enhanced the DealsList component to improve how restaurant information is displayed:

1. Added a restaurant information section at the top of each deal card that includes:
   - Restaurant image (displayed as a rounded profile picture)
   - Restaurant name with a hover effect
   - A "View restaurant details" subtitle
   - This section is only displayed when not already in a restaurant-specific context

2. Made the "View Restaurant" link available on all deal cards:
   - Previously, this link was only shown when the component had a restaurant prop
   - Now it dynamically links to either the passed restaurant ID or the deal's restaurantId

3. Maintained the existing design language with:
   - Consistent border styling
   - Responsive image handling
   - Hover effects for interactive elements
   - Appropriate dark mode support

This update provides users with more context about each deal and makes it easier to navigate to the relevant restaurant page from any deal card.

---

_**User**_

there is no imageUrl on the deal but there is on the restaurant

---

_**Assistant**_

<think>I need to fix my implementation. The issue is that I was trying to use `deal.imageUrl` and `deal.name`, but looking at the component props and type information:

1. The `DatabaseDeal` interface has `name?` and `imageUrl?` properties, but these are not accurate for what I need to show
2. The restaurant images are associated with the restaurant entity, not directly on the deal
3. To display restaurant images, I need to ensure the component has access to the restaurant data

I need to update the component to handle this correctly. Since the existing implementation doesn't have a way to show restaurant images when viewing deals outside a restaurant context, I'll need to enhance the props and data model to support this.</think>You're right - my implementation is incorrect. The `imageUrl` is on the restaurant object, not on the deal itself. Let me fix this by updating the component to properly access restaurant data.

---

```diff
  	name?: string;
  	imageUrl?: string;
+ 	restaurant?: {
+ 		id: bigint;
+ 		name: string;
+ 		imageUrl?: string;
+ 	};
  }
  
```

```diff
  		id: bigint;
  		name: string;
+ 		imageUrl?: string;
  	};
  	className?: string;
```

```diff
  					>
  						{/* Show restaurant info only when not in restaurant-specific context */}
- 						{!restaurant && deal.name && (
+ 						{!restaurant && deal.restaurant && (
  							<Link
  								href={`/restaurants/${deal.restaurantId}`}
  								className="block"
  							>
  								<div className="flex items-center p-4 border-b border-gray-100 dark:border-zinc-800">
- 									{deal.imageUrl && (
+ 									{deal.restaurant.imageUrl && (
  										<div className="relative w-12 h-12 mr-3 overflow-hidden rounded-full flex-shrink-0">
  											<Image
- 												src={deal.imageUrl}
- 												alt={deal.name || "Restaurant"}
+ 												src={deal.restaurant.imageUrl}
+ 												alt={deal.restaurant.name || "Restaurant"}
  												fill
  												className="object-cover"
```

```diff
  									<div>
  										<h4 className="font-medium text-gray-900 dark:text-gray-100 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
- 											{deal.name}
+ 											{deal.restaurant.name}
  										</h4>
  										<p className="text-xs text-gray-500 dark:text-gray-400">
```

---

I've fixed the implementation to correctly handle the restaurant data structure:

1. Updated the `DatabaseDeal` interface to include a nested `restaurant` object that has:
   - `id: bigint`
   - `name: string`
   - `imageUrl?: string`

2. Enhanced the `DealsListProps` interface to include the optional `imageUrl` field on the restaurant prop

3. Fixed the UI implementation to:
   - Check for `deal.restaurant` instead of just `deal.name`
   - Access image through `deal.restaurant.imageUrl` instead of `deal.imageUrl`
   - Display the restaurant name using `deal.restaurant.name`

This implementation now correctly handles the restaurant data structure, showing the restaurant image from the restaurant object when available. The component will now properly display the restaurant image and name in the deal card when viewing deals outside of a restaurant-specific context.

---

_**User**_

update this rendering logic now that there is a restaurant field on each deal in the array. Do not group deals by restaurant, but sort by active and created time. 

---

_**Assistant**_

<think>I need to update the DealsList component to:
1. Fix the linter error with the `restaurant` variable (it's no longer a prop)
2. Sort the deals by active status and creation time
3. Keep the restaurant info display for each deal

The main changes are:
- Remove the reference to the non-existent `restaurant` prop
- Add a sorting function to sort the deals 
- Fix the View Restaurant link</think>I'll update the component to sort the deals by active status and creation time, and fix the restaurant rendering logic.

---

```diff
  "use client";
  
- import { useState } from "react";
+ import { useState, useMemo } from "react";
  import Image from "next/image";
  import Link from "next/link";
```

```diff
  interface DealsListProps {
  	deals: DatabaseDeal[];
- 
  	className?: string;
  }
  
  export const DealsList = ({ deals, className }: DealsListProps) => {
  	const [expandedId, setExpandedId] = useState<string | null>(null);
+ 
+ 	// Sort deals by active status (active first) and then by creation date (newest first)
+ 	const sortedDeals = useMemo(() => {
+ 		return [...deals].sort((a, b) => {
+ 			// First sort by active status (active deals first)
+ 			if (a.active && !b.active) return -1;
+ 			if (!a.active && b.active) return 1;
+ 
+ 			// Then sort by creation date (newest first)
+ 			const dateA = a.createdAt ? new Date(a.createdAt).getTime() : 0;
+ 			const dateB = b.createdAt ? new Date(b.createdAt).getTime() : 0;
+ 			return dateB - dateA;
+ 		});
+ 	}, [deals]);
  
  	if (!deals || deals.length === 0) {
```

```diff
  
  			<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
- 				{deals.map((deal) => (
+ 				{sortedDeals.map((deal) => (
  					<motion.div
  						key={deal.id.toString()}
```

```diff
  						)}
  					>
- 						{/* Show restaurant info only when not in restaurant-specific context */}
+ 						{/* Show restaurant info for each deal */}
  						{deal.restaurant && (
  							<Link
```

```diff
  
  								<Link
- 									href={`/restaurants/${restaurant ? restaurant.id : deal.restaurantId}`}
+ 									href={`/restaurants/${deal.restaurantId}`}
  									className="inline-flex items-center text-xs font-medium text-blue-600 dark:text-blue-400 hover:underline"
  								>
```

---

I've updated the DealsList component with the following improvements:

1. **Added Sorting Logic**:
   - Imported `useMemo` from React to efficiently sort the deals
   - Created a `sortedDeals` memoized value that sorts deals by:
     - Active status first (active deals appear before inactive ones)
     - Then by creation date (newest deals first)
   - Used `sortedDeals` instead of raw `deals` in the rendering

2. **Fixed Restaurant Rendering**:
   - Updated the comment to "Show restaurant info for each deal"
   - Kept the logic to display restaurant information for each deal
   - Made sure the restaurant link works properly for every deal

3. **Fixed the Linter Error**:
   - Removed the reference to the non-existent `restaurant` variable
   - Updated the View Restaurant link to use only `deal.restaurantId`

4. **Maintained UI Features**:
   - Restaurant images and names are displayed when available
   - Deals can still be expanded/collapsed to read more content
   - Status indicators (active/inactive) remain working

This implementation now:
- Properly shows each deal with its associated restaurant information
- Presents a clean, consistent UI for all deals
- Prioritizes active and newer deals at the top
- Ensures all links and interactive elements work correctly

---

