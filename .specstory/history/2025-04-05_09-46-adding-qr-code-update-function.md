<!-- Generated by SpecStory -->

# Adding QR Code Update Function (2025-04-05 04:46:23)

_**User**_

I think we need to add the QrCode update function here as well

---

_**Assistant**_



---

I'll add the functionality to update the QR code by implementing the proper refresh logic in the onUpdate callback:

---

```diff
  import Link from 'next/link'
  import {QRCodeGenerator} from '@/components/qr-code/qr-code-generator'
+ import {useState, useCallback} from 'react'
+ import {useRouter} from 'next/navigation'
+ 
  const MotionImage = motion(Image)
+ 
  export function AdminRestaurantDetail({restaurant}: {restaurant: Restaurant}) {
+   const [isRefreshing, setIsRefreshing] = useState(false)
+   const router = useRouter()
+ 
+   // Function to refresh restaurant data
+   const refreshData = useCallback(() => {
+     setIsRefreshing(true)
+ 
+     // Use Next.js router to refresh the current route data
+     router.refresh()
+ 
+     // Reset the refreshing state after a short delay
+     setTimeout(() => {
+       setIsRefreshing(false)
+     }, 1000)
+   }, [router])
+ 
    // Handle case where restaurant is not found
    if (!restaurant) {
```

```diff
      <motion.div
        className='container mx-auto px-4 py-8'
-       animate={{opacity: [0, 1, 0], y: [10, 0, 10]}}
-       transition={{delay: 0.5, duration: 1, staggerChildren: 0.5}}
+       initial={{opacity: 0, y: 10}}
+       animate={{opacity: 1, y: 0}}
+       transition={{duration: 0.5}}
      >
        <div className='mb-6'>
```

```diff
            priority
            sizes='100vw'
+           initial={{opacity: 0}}
+           animate={{opacity: 1}}
+           transition={{duration: 0.5}}
          />
  
```

```diff
            <motion.h1
              className='text-3xl font-bold text-white mb-2'
-             animate={{opacity: [0, 1, 0], y: [10, 0, 10]}}
-             transition={{delay: 0.5, duration: 1}}
+             initial={{opacity: 0, y: 10}}
+             animate={{opacity: 1, y: 0}}
+             transition={{delay: 0.2, duration: 0.5}}
            >
              {restaurant.name}
            </motion.h1>
            <motion.p
              className='text-white text-opacity-90'
-             animate={{opacity: [0, 1, 0], y: [10, 0, 10]}}
-             transition={{delay: 0.5, duration: 1}}
+             initial={{opacity: 0, y: 10}}
+             animate={{opacity: 1, y: 0}}
+             transition={{delay: 0.3, duration: 0.5}}
            >
              {restaurant.address}
```

```diff
        <motion.div
          className='mt-4 grid grid-cols-1 md:grid-cols-3 gap-6'
-         animate={{opacity: [0, 1, 0], y: [10, 0, 10]}}
-         transition={{delay: 0.5, duration: 1}}
+         initial={{opacity: 0, y: 10}}
+         animate={{opacity: 1, y: 0}}
+         transition={{delay: 0.4, duration: 0.5}}
        >
          {/* QR Code Section */}
```

```diff
              onUpdate={() => {
                // Force refresh the data
+               refreshData()
              }}
            />
+           {isRefreshing && (
+             <p className='text-sm text-blue-500 mt-2'>Refreshing data...</p>
+           )}
          </motion.div>
  
```

---

_**User**_

No. This one from @restaurants-table.tsx 

---

_**Assistant**_



---

I'll replace my implementation with the pattern from restaurants-table.tsx:

---

```diff
  import {useState, useCallback} from 'react'
  import {useRouter} from 'next/navigation'
+ import {toast} from 'sonner'
  
  const MotionImage = motion(Image)
  
  export function AdminRestaurantDetail({restaurant}: {restaurant: Restaurant}) {
-   const [isRefreshing, setIsRefreshing] = useState(false)
+   const [localRestaurant, setLocalRestaurant] = useState(restaurant)
    const router = useRouter()
  
    // Function to refresh restaurant data
    const refreshData = useCallback(() => {
-     setIsRefreshing(true)
- 
-     // Use Next.js router to refresh the current route data
      router.refresh()
- 
-     // Reset the refreshing state after a short delay
-     setTimeout(() => {
-       setIsRefreshing(false)
-     }, 1000)
+     toast.success('Restaurant data refreshed')
    }, [router])
+ 
+   // Handle QR code update using same pattern as in restaurants-table.tsx
+   const handleQRCodeUpdate = useCallback(
+     (updatedRestaurant: Restaurant | undefined) => {
+       if (updatedRestaurant) {
+         // Update the local state with the updated restaurant
+         setLocalRestaurant((prevData) => ({
+           ...prevData,
+           qrCodeUrl: updatedRestaurant.qrCodeUrl,
+         }))
+         // Show success message
+         toast.success('QR code created successfully')
+       } else {
+         // Fall back to the old refresh method if no updated restaurant is provided
+         refreshData()
+       }
+     },
+     [refreshData]
+   )
  
    // Handle case where restaurant is not found
```

```diff
      <motion.div
        className='container mx-auto px-4 py-8'
-       initial={{opacity: 0, y: 10}}
-       animate={{opacity: 1, y: 0}}
-       transition={{duration: 0.5}}
+       animate={{opacity: [0, 1, 0], y: [10, 0, 10]}}
+       transition={{delay: 0.5, duration: 1, staggerChildren: 0.5}}
      >
        <div className='mb-6'>
```

```diff
        <motion.div className='relative h-64 w-full mb-8 rounded-lg overflow-hidden'>
          <MotionImage
-           src={restaurant.imageUrl || '/RWP.jpg'}
-           alt={`${restaurant.name} featured image`}
+           src={localRestaurant.imageUrl || '/RWP.jpg'}
+           alt={`${localRestaurant.name} featured image`}
            fill
            className='object-cover'
            priority
            sizes='100vw'
-           initial={{opacity: 0}}
-           animate={{opacity: 1}}
-           transition={{duration: 0.5}}
          />
  
```

```diff
            <motion.h1
              className='text-3xl font-bold text-white mb-2'
-             initial={{opacity: 0, y: 10}}
-             animate={{opacity: 1, y: 0}}
-             transition={{delay: 0.2, duration: 0.5}}
+             animate={{opacity: [0, 1, 0], y: [10, 0, 10]}}
+             transition={{delay: 0.5, duration: 1}}
            >
-             {restaurant.name}
+             {localRestaurant.name}
            </motion.h1>
            <motion.p
              className='text-white text-opacity-90'
-             initial={{opacity: 0, y: 10}}
-             animate={{opacity: 1, y: 0}}
-             transition={{delay: 0.3, duration: 0.5}}
+             animate={{opacity: [0, 1, 0], y: [10, 0, 10]}}
+             transition={{delay: 0.5, duration: 1}}
            >
-             {restaurant.address}
+             {localRestaurant.address}
            </motion.p>
          </motion.div>
```

```diff
        <div className='mb-8'>
          <h2 className='text-2xl font-semibold mb-4'>About</h2>
-         <p className='text-gray-700'>{restaurant.description}</p>
+         <p className='text-gray-700'>{localRestaurant.description}</p>
        </div>
  
        <motion.div
          className='mt-4 grid grid-cols-1 md:grid-cols-3 gap-6'
-         initial={{opacity: 0, y: 10}}
-         animate={{opacity: 1, y: 0}}
-         transition={{delay: 0.4, duration: 0.5}}
+         animate={{opacity: [0, 1, 0], y: [10, 0, 10]}}
+         transition={{delay: 0.5, duration: 1}}
        >
          {/* QR Code Section */}
          <motion.div className='md:col-span-1'>
            <QRCodeGenerator
-             restaurant={restaurant}
-             onUpdate={() => {
-               // Force refresh the data
-               refreshData()
-             }}
+             restaurant={localRestaurant}
+             onUpdate={handleQRCodeUpdate}
            />
-           {isRefreshing && (
-             <p className='text-sm text-blue-500 mt-2'>Refreshing data...</p>
-           )}
          </motion.div>
  
```

---

