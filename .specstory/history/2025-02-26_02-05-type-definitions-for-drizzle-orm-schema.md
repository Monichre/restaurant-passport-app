<!-- Generated by SpecStory -->

# Type Definitions for Drizzle ORM Schema (2025-02-25 20:05:48)

_**User**_

generate type defs 

---

_**Assistant**_

<think>The user is asking me to generate type definitions based on the schema.ts file they've attached. Looking at the file, it contains a Drizzle ORM schema for a PostgreSQL database for a restaurant passport application.

I need to create TypeScript type definitions that correspond to this database schema. These types would be useful for type checking and auto-completion when working with data from these tables.

The schema has the following tables:
- users
- restaurants
- punchCards
- raffleEntries
- prizes
- prizeRedemptions
- pointBalances
- pointTransfers
- achievements

I'll create TypeScript interfaces for each of these tables, making sure to match the column types appropriately. I'll also define any necessary related types for JSON fields like the "rules" field in the prizes table.</think>I'll generate TypeScript type definitions that match your Drizzle ORM schema. These types will be useful for working with your data throughout the application.

---

```diff
- 
+ /**
+  * Type definitions for database models
+  */
+ 
+ /**
+  * User model
+  */
+ export type User = {
+   id: bigint;
+   clerkId: string;
+   name: string;
+   isStaff: boolean;
+   isAdmin: boolean;
+   email: string;
+   phone: string | null;
+ };
+ 
+ /**
+  * Restaurant model
+  */
+ export type Restaurant = {
+   id: bigint;
+   name: string;
+   description: string;
+   imageUrl: string;
+   address: string;
+   qrCodeUrl: string | null;
+ };
+ 
+ /**
+  * Punch card model
+  */
+ export type PunchCard = {
+   id: bigint;
+   userId: bigint;
+   restaurantId: bigint;
+   punches: number;
+   completed: boolean;
+   updatedAt: Date;
+ };
+ 
+ /**
+  * Raffle entry model
+  */
+ export type RaffleEntry = {
+   id: bigint;
+   userId: bigint;
+   punchCardId: bigint;
+   createdAt: Date;
+ };
+ 
+ /**
+  * Prize rules type
+  */
+ export type PrizeRules = {
+   expirationDays?: number;
+   usageLimit?: number;
+   terms?: string;
+   [key: string]: unknown;
+ };
+ 
+ /**
+  * Prize model
+  */
+ export type Prize = {
+   id: bigint;
+   name: string;
+   description: string;
+   imageUrl: string;
+   type: string;
+   restaurantId: bigint;
+   requiredPunches: number;
+   available: boolean;
+   quantity: number;
+   rules: PrizeRules;
+   createdAt: Date;
+ };
+ 
+ /**
+  * Prize redemption status type
+  */
+ export type RedemptionStatus = "pending" | "redeemed" | "expired" | "cancelled";
+ 
+ /**
+  * Prize redemption model
+  */
+ export type PrizeRedemption = {
+   id: bigint;
+   userId: bigint;
+   prizeId: bigint;
+   punchCardId: bigint;
+   status: RedemptionStatus;
+   redeemedAt: Date | null;
+   expiresAt: Date | null;
+   createdAt: Date;
+ };
+ 
+ /**
+  * Point balance model
+  */
+ export type PointBalance = {
+   id: bigint;
+   userId: bigint;
+   points: number;
+   updatedAt: Date;
+ };
+ 
+ /**
+  * Point transfer status type
+  */
+ export type TransferStatus = "pending" | "completed" | "cancelled";
+ 
+ /**
+  * Point transfer model
+  */
+ export type PointTransfer = {
+   id: bigint;
+   fromUserId: bigint;
+   toUserId: bigint;
+   points: number;
+   message: string | null;
+   status: TransferStatus;
+   createdAt: Date;
+ };
+ 
+ /**
+  * Achievement type enum
+  */
+ export type AchievementType = 
+   | "first_transfer" 
+   | "transfer_milestone" 
+   | "punch_card_complete" 
+   | "prize_redemption";
+ 
+ /**
+  * Achievement data type
+  */
+ export type AchievementData = {
+   milestone?: number;
+   restaurantId?: bigint;
+   prizeId?: bigint;
+   [key: string]: unknown;
+ };
+ 
+ /**
+  * Achievement model
+  */
+ export type Achievement = {
+   id: bigint;
+   userId: bigint;
+   type: AchievementType;
+   data: AchievementData;
+   unlockedAt: Date;
+ }; 
```

---



Now let's create some Zod validation schemas that match these types, which will be useful for validating data in your API routes and forms:

---

```diff
- 
+ import { z } from "zod";
+ import type { 
+   User, 
+   Restaurant, 
+   PunchCard, 
+   Prize, 
+   PrizeRedemption, 
+   PointTransfer,
+   Achievement
+ } from "./db";
+ 
+ /**
+  * User schemas
+  */
+ export const userSchema = z.object({
+   id: z.bigint(),
+   clerkId: z.string(),
+   name: z.string(),
+   isStaff: z.boolean(),
+   isAdmin: z.boolean(),
+   email: z.string().email(),
+   phone: z.string().nullable(),
+ });
+ 
+ export const createUserSchema = userSchema.omit({ 
+   id: true,
+   isStaff: true,
+   isAdmin: true 
+ }).extend({
+   isStaff: z.boolean().optional(),
+   isAdmin: z.boolean().optional(),
+ });
+ 
+ export type CreateUserInput = z.infer<typeof createUserSchema>;
+ 
+ /**
+  * Restaurant schemas
+  */
+ export const restaurantSchema = z.object({
+   id: z.bigint(),
+   name: z.string(),
+   description: z.string(),
+   imageUrl: z.string().url(),
+   address: z.string(),
+   qrCodeUrl: z.string().url().nullable(),
+ });
+ 
+ export const createRestaurantSchema = restaurantSchema.omit({ 
+   id: true,
+   qrCodeUrl: true 
+ });
+ 
+ export type CreateRestaurantInput = z.infer<typeof createRestaurantSchema>;
+ 
+ /**
+  * Punch card schemas
+  */
+ export const punchCardSchema = z.object({
+   id: z.bigint(),
+   userId: z.bigint(),
+   restaurantId: z.bigint(),
+   punches: z.number().int().min(0),
+   completed: z.boolean(),
+   updatedAt: z.date(),
+ });
+ 
+ export const createPunchCardSchema = punchCardSchema.omit({ 
+   id: true, 
+   punches: true, 
+   completed: true,
+   updatedAt: true 
+ });
+ 
+ export type CreatePunchCardInput = z.infer<typeof createPunchCardSchema>;
+ 
+ /**
+  * Prize schemas
+  */
+ export const prizeRulesSchema = z.object({
+   expirationDays: z.number().int().min(1).optional(),
+   usageLimit: z.number().int().min(1).optional(),
+   terms: z.string().optional(),
+ }).catchall(z.unknown());
+ 
+ export const prizeSchema = z.object({
+   id: z.bigint(),
+   name: z.string(),
+   description: z.string(),
+   imageUrl: z.string().url(),
+   type: z.string(),
+   restaurantId: z.bigint(),
+   requiredPunches: z.number().int().min(1),
+   available: z.boolean(),
+   quantity: z.number().int().min(0),
+   rules: prizeRulesSchema,
+   createdAt: z.date(),
+ });
+ 
+ export const createPrizeSchema = prizeSchema.omit({ 
+   id: true, 
+   createdAt: true 
+ });
+ 
+ export type CreatePrizeInput = z.infer<typeof createPrizeSchema>;
+ 
+ /**
+  * Prize redemption schemas
+  */
+ export const redemptionStatusSchema = z.enum([
+   "pending", 
+   "redeemed", 
+   "expired", 
+   "cancelled"
+ ]);
+ 
+ export const prizeRedemptionSchema = z.object({
+   id: z.bigint(),
+   userId: z.bigint(),
+   prizeId: z.bigint(),
+   punchCardId: z.bigint(),
+   status: redemptionStatusSchema,
+   redeemedAt: z.date().nullable(),
+   expiresAt: z.date().nullable(),
+   createdAt: z.date(),
+ });
+ 
+ export const createPrizeRedemptionSchema = prizeRedemptionSchema.omit({ 
+   id: true,
+   status: true,
+   redeemedAt: true,
+   createdAt: true
+ }).extend({
+   status: redemptionStatusSchema.default("pending"),
+ });
+ 
+ export type CreatePrizeRedemptionInput = z.infer<typeof createPrizeRedemptionSchema>;
+ 
+ /**
+  * Point transfer schemas
+  */
+ export const transferStatusSchema = z.enum([
+   "pending", 
+   "completed", 
+   "cancelled"
+ ]);
+ 
+ export const pointTransferSchema = z.object({
+   id: z.bigint(),
+   fromUserId: z.bigint(),
+   toUserId: z.bigint(),
+   points: z.number().int().positive(),
+   message: z.string().nullable(),
+   status: transferStatusSchema,
+   createdAt: z.date(),
+ });
+ 
+ export const createPointTransferSchema = pointTransferSchema.omit({ 
+   id: true, 
+   status: true,
+   createdAt: true 
+ }).extend({
+   status: transferStatusSchema.default("pending"),
+   message: z.string().max(200).optional().nullable(),
+ });
+ 
+ export type CreatePointTransferInput = z.infer<typeof createPointTransferSchema>;
+ 
+ /**
+  * Achievement schemas
+  */
+ export const achievementTypeSchema = z.enum([
+   "first_transfer", 
+   "transfer_milestone", 
+   "punch_card_complete", 
+   "prize_redemption"
+ ]);
+ 
+ export const achievementDataSchema = z.object({
+   milestone: z.number().optional(),
+   restaurantId: z.bigint().optional(),
+   prizeId: z.bigint().optional(),
+ }).catchall(z.unknown());
+ 
+ export const achievementSchema = z.object({
+   id: z.bigint(),
+   userId: z.bigint(),
+   type: achievementTypeSchema,
+   data: achievementDataSchema,
+   unlockedAt: z.date(),
+ });
+ 
+ export const createAchievementSchema = achievementSchema.omit({ 
+   id: true,
+   unlockedAt: true 
+ });
+ 
+ export type CreateAchievementInput = z.infer<typeof createAchievementSchema>; 
```

---



Now let's create a file with helper types for API responses and requests:

---

```diff
- 
+ import type { 
+   User, 
+   Restaurant, 
+   PunchCard, 
+   Prize, 
+   PrizeRedemption, 
+   PointBalance,
+   PointTransfer,
+   Achievement
+ } from "./db";
+ 
+ /**
+  * Generic API response
+  */
+ export type ApiResponse<T = unknown> = {
+   success: boolean;
+   data?: T;
+   error?: string;
+   message?: string;
+ };
+ 
+ /**
+  * Pagination metadata
+  */
+ export type PaginationMeta = {
+   page: number;
+   pageSize: number;
+   total: number;
+   totalPages: number;
+   hasMore: boolean;
+ };
+ 
+ /**
+  * Paginated API response
+  */
+ export type PaginatedApiResponse<T = unknown> = ApiResponse<{
+   items: T[];
+   meta: PaginationMeta;
+ }>;
+ 
+ /**
+  * Pagination query parameters
+  */
+ export type PaginationParams = {
+   page?: number;
+   pageSize?: number;
+ };
+ 
+ /**
+  * User-related API types
+  */
+ export type UserWithPointBalance = User & {
+   pointBalance: PointBalance;
+ };
+ 
+ export type UserProfileResponse = ApiResponse<{
+   user: UserWithPointBalance;
+   punchCards: PunchCard[];
+   achievements: Achievement[];
+ }>;
+ 
+ /**
+  * Restaurant-related API types
+  */
+ export type RestaurantWithPrizes = Restaurant & {
+   prizes: Prize[];
+ };
+ 
+ export type RestaurantDetailResponse = ApiResponse<RestaurantWithPrizes>;
+ 
+ /**
+  * Point transfer-related API types
+  */
+ export type PointTransferWithUsers = PointTransfer & {
+   fromUser: {
+     id: bigint;
+     name: string;
+   };
+   toUser: {
+     id: bigint;
+     name: string;
+   };
+ };
+ 
+ /**
+  * Punch card-related API types
+  */
+ export type PunchCardWithRestaurant = PunchCard & {
+   restaurant: Restaurant;
+ };
+ 
+ /**
+  * Prize redemption-related API types
+  */
+ export type PrizeRedemptionWithDetails = PrizeRedemption & {
+   prize: Prize;
+   restaurant: {
+     id: bigint;
+     name: string;
+     imageUrl: string;
+   };
+ };
+ 
+ /**
+  * QR code related types
+  */
+ export type QrCodePayload = {
+   type: "punch_card";
+   userId: string;
+   restaurantId: string;
+ } | {
+   type: "prize_redemption";
+   redemptionId: string;
+ };
+ 
+ /**
+  * Analytics related types
+  */
+ export type RestaurantAnalytics = {
+   totalPunchCards: number;
+   completedPunchCards: number;
+   activeUsers: number;
+   prizeRedemptions: number;
+   dailyStats: Array<{
+     date: string;
+     punches: number;
+     completions: number;
+     redemptions: number;
+   }>;
+ };
+ 
+ /**
+  * Leaderboard entry
+  */
+ export type LeaderboardEntry = {
+   userId: bigint;
+   userName: string;
+   points: number;
+   rank: number;
+ };
+ 
+ /**
+  * System admin dashboard stats
+  */
+ export type AdminDashboardStats = {
+   totalUsers: number;
+   totalRestaurants: number;
+   totalPunches: number;
+   totalPrizeRedemptions: number;
+   activeUsersLast30Days: number;
+ }; 
```

---



Finally, let's create an index file to export all the types for easier importing:

---

```diff
- 
+ /**
+  * Re-export all types from the types subdirectory
+  */
+ 
+ // Database model types
+ export * from "./db";
+ 
+ // Zod validation schemas
+ export * from "./schemas";
+ 
+ // API related types
+ export * from "./api";
+ 
+ // Auth related types
+ export type UserRole = "user" | "restaurant_admin" | "system_admin";
+ 
+ export type AuthUser = {
+   id: string;
+   clerkId: string;
+   name: string;
+   email: string;
+   role: UserRole;
+   restaurantIds?: bigint[]; // Only for restaurant_admin
+ };
+ 
+ // Application state types
+ export type ToastType = "success" | "error" | "info" | "warning";
+ 
+ export type Toast = {
+   id: string;
+   type: ToastType;
+   title: string;
+   message: string;
+   duration?: number;
+ };
+ 
+ // UI specific types
+ export type SortDirection = "asc" | "desc";
+ 
+ export type SortOption<T extends string = string> = {
+   field: T;
+   direction: SortDirection;
+ };
+ 
+ export type FilterOption<T extends string = string> = {
+   field: T;
+   value: string | number | boolean | null;
+   operator?: "eq" | "neq" | "gt" | "gte" | "lt" | "lte" | "contains";
+ };
+ 
+ // Theme
+ export type Theme = "light" | "dark" | "system";
+ 
+ // QR Code
+ export type QRCodeSize = "sm" | "md" | "lg";
+ 
+ // Feature flags
+ export type FeatureFlag = {
+   name: string;
+   enabled: boolean;
+   description?: string;
+ }; 
```

---



I've created a comprehensive set of TypeScript type definitions for your restaurant passport application:

1. **Database Model Types** (`src/types/db.ts`):
   - Defined all your database entities (User, Restaurant, PunchCard, etc.)
   - Added specific type definitions for JSON fields like PrizeRules
   - Included appropriate type definitions for status fields and timestamps

2. **Zod Validation Schemas** (`src/types/schemas.ts`):
   - Created Zod schemas that match your database models
   - Added validation rules (min/max values, email format, etc.)
   - Created separate schemas for creating new records
   - Added type exports for form inputs using `z.infer`

3. **API Types** (`src/types/api.ts`):
   - Defined generic API response patterns with success/error handling
   - Added pagination types for list endpoints
   - Created types for complex data relationships (e.g., PunchCardWithRestaurant)
   - Added types for analytics and leaderboard data

4. **Index File** (`src/types/index.ts`):
   - Re-exports all types from the other files
   - Added additional application-specific types:
     - Auth-related types (UserRole, AuthUser)
     - UI types (Toast, SortOption, FilterOption)
     - Theme and feature flag types

These type definitions provide a solid foundation for type safety throughout your application. You can now import these types in your components, API routes, and utility functions to ensure type consistency and get excellent IDE auto-completion.

---

